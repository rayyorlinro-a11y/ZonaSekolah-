<!DOCTYPE html>
<html>
<head>
  <title>Admin - ACC Laporan</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>Daftar Laporan Pending</h2>
<div id="pendingList"></div>

<script type="module">
import { db } from "./script.js";
import { collection, query, where, getDocs, updateDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const pendingList = document.getElementById("pendingList");

async function loadPending() {
  const q = query(
    collection(db, "laporan"),
    where("status", "==", "pending")
  );

  const querySnapshot = await getDocs(q);

  querySnapshot.forEach((docSnap) => {
    const data = docSnap.data();

    const div = document.createElement("div");
    div.innerHTML = `
      <p><strong>${data.namaSekolah}</strong></p>
      <button onclick="approve('${docSnap.id}')">ACC</button>
      <hr>
    `;
    
    pendingList.appendChild(div);
  });
}

window.approve = async (id) => {
  await updateDoc(doc(db, "laporan", id), {
    status: "approved"
  });

  alert("Berhasil di-ACC");
  location.reload();
}

loadPending();
</script>

</body>
</html>
